{% extends "dlf-base.html" %}

{% block beforeContent %}
 {{ super() }}

 {{ govukBreadcrumbs({
   "items": [
    {
       "text": "Home",
       "href": url_for("frontend.index")
     },
     {
       "text": "Planning Authority",
       "href": url_for("frontend.planning_authority_list")
     },
     {
       "text": planning_authority.name
     }
   ]
 }) }}

{% endblock %}

{% block content %}

  <span class="govuk-caption-xl">Local plan</span>
  <h1 class="govuk-heading-xl">{{ planning_authority.name }}</h1>


 {#    Not sure how we're going to construct this schedule are we hoping to find this from scheme? or
        combination of scheme and pins dates?
    #}

  <h2 class="govuk-heading-l">Schedule</h2>
  <div class="graph-placeholder">
    <span class="govuk-body">Placeholder for schedule graph</span>
  </div>

  <h2 class="govuk-heading-l">Number of houses</h2>
  {% macro singleBarComponent(label, value, width, _classes) -%}
    <div class="govuk-grid-row contribution-category-row">
      <div class="govuk-grid-column-two-thirds contribution-bar-container">
        <div class="contribution-bar{% if _classes %} {{ _classes }}{% endif %}" style="width: {{ width }};">
          <span class="govuk-!-font-size-24 govuk-!-font-weight-bold data-item">{{ value }}</span>
        </div>
        <div class="govuk-!-font-size-24 data-item cb-floating-figure">{{ value }}</div>
      </div>
      <div class="govuk-grid-column-one-third">
        <h4 class="govuk-heading-s contribution-category-heading">{{ label }}</h4>
      </div>
    </div>
  {%- endmacro %}

  {% for hdt in planning_authority.sorted_hdt(reverse=True) %}
    {% set max_figure = [hdt.homes_required, hdt.homes_delivered]|max %}

    <section class="hdt-figure-section">
      <h3 class="govuk-heading-m">{{ hdt.from_year.year }} - {{ hdt.to_year.year }}</h3>
      {% set required = hdt.homes_required | return_percent(denominator=max_figure) | format_percent %}
      {{ singleBarComponent("HDT required", hdt.homes_required, required) }}

{#        assuming this percentage is % of delivered measure against required#}

      {% set delivered = hdt.homes_delivered | return_percent(denominator=max_figure) | format_percent %}
      {{ singleBarComponent("HDT delivered", hdt.homes_delivered, delivered, "bar--blue") }}

      {{ singleBarComponent("Local plan commitment", "???", "70%", "bar--light-blue") }}
{#      need to work out how to get local plan commitment - it will be attached to a plan and a document#}
{#      specifically so we have to hope that they are recorded accoring to this breakdown of years#}
{#      so that we can match with these figures - possibly a jump to far in terms of how this is currently#}
{#      modelled?#}
    </section>

  {% endfor %}


<h2 class="govuk-heading-l govuk-!-margin-top-9">Local plans</h2>


<div class="govuk-tabs" data-module="tabs">
    <h2 class="govuk-tabs__title">
      Contents
    </h2>

    <ul class="govuk-tabs__list">
      {% for plan in planning_authority.local_plans|sort_plans %}
      <li class="govuk-tabs__list-item {% if plan.is_adopted() %}adopted-plan{% endif %}">
        <a class="govuk-tabs__tab govuk-tabs__tab--selected" href="#{{ plan.local_plan }}">
          {{ plan.local_plan }}
        </a>
      </li>
      {% endfor %}
    </ul>

    {% for plan in planning_authority.local_plans|sort_plans %}
    <section class="govuk-tabs__panel govuk-tabs__panel--no-bottom-padding {% if plan.is_adopted() %}adopted-plan{% endif %}" id="{{ plan.local_plan }}">
      <h3 class="govuk-heading-m">{{ plan.local_plan }}</h3>

      <section class="local-plan-part">
        <h4 class="govuk-heading-s"><a class="dl-heading-link" href="#">Local plan part 1</a></h4>
        <div class="govuk-grid-column-half per-year-figure">
          <span class="govuk-body">2018 - 2019</span>
          <span class="govuk-body">231</span>
        </div>
        <div class="govuk-grid-column-half per-year-figure">
          <span class="govuk-body">2017 - 2018</span>
          <span class="govuk-body">325</span>
        </div>
      </section>

      <section class="local-plan-part">
        <h4 class="govuk-heading-s"><a class="dl-heading-link" href="#">Local plan part 2</a></h4>
        <div class="per-year-figure">
          <span class="govuk-body">2018 - 2019</span>
          <span class="govuk-body">231</span>
        </div>
        <div class="per-year-figure">
          <span class="govuk-body">2017 - 2018</span>
          <span class="govuk-body">325</span>
        </div>
      </section>

    </section>
    {% endfor %}

  </div>

{% endblock %}